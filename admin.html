<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - HIRE-ME</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome@6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            min-height: 100vh;
            background-color: #f8fafc;
        }

        .admin-sidebar {
            background: white;
            min-height: 100vh;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
        }

        .admin-header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 20px 0;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #4b5563;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .sidebar-link:hover {
            background: #f3f4f6;
            color: #2563eb;
        }

        .sidebar-link.active {
            background: #eff6ff;
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }

        .sidebar-link i {
            margin-right: 10px;
            width: 20px;
        }

        .main-content {
            padding: 30px;
        }

        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            border: 1px solid #e5e7eb;
        }

        .stats-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stats-icon.pending {
            background: rgba(251, 191, 36, 0.1);
            color: #d97706;
        }

        .stats-icon.confirmed {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .stats-icon.delivered {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .orders-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .table th {
            background: #f8fafc;
            border: none;
            font-weight: 600;
            color: #374151;
            padding: 15px;
        }

        .table td {
            border: none;
            padding: 15px;
            vertical-align: middle;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background-color: rgba(251, 191, 36, 0.1);
            color: #d97706;
        }

        .status-confirmed {
            background-color: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .status-processing {
            background-color: rgba(139, 69, 19, 0.1);
            color: #8b4513;
        }

        .status-shipped {
            background-color: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .status-delivered {
            background-color: rgba(107, 114, 128, 0.1);
            color: #4b5563;
        }

        .status-cancelled {
            background-color: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .btn-action {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            margin-right: 5px;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 admin-sidebar">
            <div class="admin-header">
                <div class="text-center">
                    <h5 class="mb-0">
                        <i class="fas fa-tools me-2"></i>HIRE-ME
                    </h5>
                    <small>Admin Dashboard</small>
                </div>
            </div>

            <div class="sidebar-menu">
                <a href="#" class="sidebar-link active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#" class="sidebar-link" onclick="showSection('orders')">
                    <i class="fas fa-shopping-bag"></i>
                    Orders
                </a>
                <a href="#" class="sidebar-link" onclick="showSection('products')">
                    <i class="fas fa-box"></i>
                    Products
                </a>
                <a href="#" class="sidebar-link" onclick="showSection('users')">
                    <i class="fas fa-users"></i>
                    Users
                </a>
                <a href="#" class="sidebar-link" onclick="showSection('analytics')">
                    <i class="fas fa-chart-bar"></i>
                    Analytics
                </a>
                <a href="index.html" class="sidebar-link">
                    <i class="fas fa-arrow-left"></i>
                    Back to Site
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="main-content">
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="content-section">
                    <h2>Dashboard Overview</h2>

                    <!-- Stats Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Pending Orders</h6>
                                        <h3 id="pendingCount" class="mb-0">0</h3>
                                    </div>
                                    <div class="stats-icon pending">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Confirmed Orders</h6>
                                        <h3 id="confirmedCount" class="mb-0">0</h3>
                                    </div>
                                    <div class="stats-icon confirmed">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Total Revenue</h6>
                                        <h3 id="totalRevenue" class="mb-0">KES 0</h3>
                                    </div>
                                    <div class="stats-icon delivered">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Total Orders</h6>
                                        <h3 id="totalOrders" class="mb-0">0</h3>
                                    </div>
                                    <div class="stats-icon delivered">
                                        <i class="fas fa-shopping-bag"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="stats-card">
                        <h5 class="mb-3">Recent Orders</h5>
                        <div id="recentOrders">
                            <p class="text-muted text-center">Loading recent orders...</p>
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="ordersSection" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Order Management</h2>
                        <div class="d-flex gap-2">
                            <select class="form-select" id="statusFilter" onchange="filterOrders()" style="width: auto;">
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="processing">Processing</option>
                                <option value="shipped">Shipped</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>

                    <div class="orders-table">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td colspan="6" class="text-center">Loading orders...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Other sections (placeholders) -->
                <div id="productsSection" class="content-section" style="display: none;">
                    <h2>Product Management</h2>
                    <p>Product management features will be implemented in the next phase.</p>
                </div>

                <div id="usersSection" class="content-section" style="display: none;">
                    <h2>User Management</h2>
                    <p>User management features will be implemented in the next phase.</p>
                </div>

                <div id="analyticsSection" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Analytics & Reports</h2>
                        <div class="d-flex gap-2">
                            <select class="form-select" id="analyticsPeriod" onchange="loadAnalytics()">
                                <option value="30">Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                            </select>
                        </div>
                    </div>

                    <!-- Analytics Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Total Revenue</h6>
                                        <h3 id="analyticsRevenue" class="mb-0">KES 0</h3>
                                    </div>
                                    <div class="stats-icon delivered">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Total Orders</h6>
                                        <h3 id="analyticsOrders" class="mb-0">0</h3>
                                    </div>
                                    <div class="stats-icon confirmed">
                                        <i class="fas fa-shopping-bag"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Avg Order Value</h6>
                                        <h3 id="analyticsAvgOrder" class="mb-0">KES 0</h3>
                                    </div>
                                    <div class="stats-icon processing">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stats-card">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">Completion Rate</h6>
                                        <h3 id="analyticsCompletion" class="mb-0">0%</h3>
                                    </div>
                                    <div class="stats-icon delivered">
                                        <i class="fas fa-percentage"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-8">
                            <div class="stats-card">
                                <h5 class="mb-3">Revenue Trend</h5>
                                <canvas id="revenueChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stats-card">
                                <h5 class="mb-3">Order Status Distribution</h5>
                                <canvas id="statusChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Analytics -->
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="stats-card">
                                <h5 class="mb-3">Top Products</h5>
                                <div id="topProducts">
                                    <p class="text-muted">Loading...</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stats-card">
                                <h5 class="mb-3">Payment Methods</h5>
                                <canvas id="paymentChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Status Update Modal -->
    <div class="modal fade" id="statusModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Order Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Order #<span id="modalOrderNumber"></span></label>
                    </div>
                    <div class="mb-3">
                        <label for="newStatus" class="form-label">New Status</label>
                        <select class="form-select" id="newStatus">
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="processing">Processing</option>
                            <option value="shipped">Shipped</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateOrderStatus()">Update Status</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let allOrders = [];
        let currentOrderId = null;

        // Show section
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });

            document.getElementById(section + 'Section').style.display = 'block';
            event.target.classList.add('active');

            if (section === 'orders') {
                loadAllOrders();
            } else if (section === 'dashboard') {
                loadDashboardData();
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            const token = localStorage.getItem('token');

            try {
                const response = await fetch('/api/admin/orders', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    allOrders = await response.json();
                    updateDashboardStats();
                    displayRecentOrders();
                } else {
                    console.error('Failed to load dashboard data');
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const stats = {
                pending: allOrders.filter(order => order.status === 'pending').length,
                confirmed: allOrders.filter(order => order.status === 'confirmed').length,
                delivered: allOrders.filter(order => order.status === 'delivered').length,
                total: allOrders.length,
                revenue: allOrders
                    .filter(order => order.status === 'delivered')
                    .reduce((sum, order) => sum + parseFloat(order.total_amount || 0), 0)
            };

            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('confirmedCount').textContent = stats.confirmed;
            document.getElementById('totalOrders').textContent = stats.total;
            document.getElementById('totalRevenue').textContent = formatCurrency(stats.revenue);
        }

        // Display recent orders on dashboard
        function displayRecentOrders() {
            const recentOrders = allOrders.slice(0, 5);
            const container = document.getElementById('recentOrders');

            if (recentOrders.length === 0) {
                container.innerHTML = '<p class="text-muted">No orders yet</p>';
                return;
            }

            container.innerHTML = recentOrders.map(order => `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <strong>#${order.order_number}</strong>
                        <br>
                        <small class="text-muted">${order.customer_name}</small>
                    </div>
                    <div class="text-end">
                        <div>${formatCurrency(order.total_amount)}</div>
                        <span class="status-badge ${getStatusBadgeClass(order.status)}">
                            ${getStatusText(order.status)}
                        </span>
                    </div>
                </div>
            `).join('<hr>');
        }

        // Load all orders for management
        async function loadAllOrders() {
            const token = localStorage.getItem('token');

            const loadingRow = document.getElementById('ordersTableBody');
            loadingRow.innerHTML = '<tr><td colspan="6" class="text-center">Loading orders...</td></tr>';

            try {
                const response = await fetch('/api/admin/orders', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    allOrders = await response.json();
                    displayOrdersTable();
                } else {
                    loadingRow.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Failed to load orders</td></tr>';
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                loadingRow.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading orders</td></tr>';
            }
        }

        // Display orders in table
        function displayOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            const statusFilter = document.getElementById('statusFilter').value;
            let filteredOrders = allOrders;

            if (statusFilter !== 'all') {
                filteredOrders = allOrders.filter(order => order.status === statusFilter);
            }

            if (filteredOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">No orders found</td></tr>';
                return;
            }

            tbody.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td>
                        <strong>#${order.order_number}</strong>
                        <br>
                        <small class="text-muted">${order.item_count} items</small>
                    </td>
                    <td>
                        <strong>${order.customer_name}</strong>
                        <br>
                        <small class="text-muted">${order.customer_email}</small>
                    </td>
                    <td>${formatCurrency(order.total_amount)}</td>
                    <td>
                        <span class="status-badge ${getStatusBadgeClass(order.status)}">
                            ${getStatusText(order.status)}
                        </span>
                    </td>
                    <td>${formatDate(order.created_at)}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewOrderDetails('${order.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="showStatusModal('${order.id}', '${order.order_number}', '${order.status}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Filter orders
        function filterOrders() {
            displayOrdersTable();
        }

        // Show status update modal
        function showStatusModal(orderId, orderNumber, currentStatus) {
            currentOrderId = orderId;
            document.getElementById('modalOrderNumber').textContent = orderNumber;
            document.getElementById('newStatus').value = currentStatus;

            new bootstrap.Modal(document.getElementById('statusModal')).show();
        }

        // Update order status
        async function updateOrderStatus() {
            const newStatus = document.getElementById('newStatus').value;
            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`/api/admin/orders/${currentOrderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('statusModal')).hide();
                    loadAllOrders(); // Reload orders
                    loadDashboardData(); // Update dashboard stats
                    alert('Order status updated successfully');
                } else {
                    const error = await response.json();
                    alert(`Failed to update status: ${error.message}`);
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                alert('Failed to update order status');
            }
        }

        // View order details
        function viewOrderDetails(orderId) {
            window.open(`confirmation.html?orderId=${orderId}`, '_blank');
        }

        // Helper functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-KE', {
                style: 'currency',
                currency: 'KES'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-KE', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getStatusBadgeClass(status) {
            const statusMap = {
                'pending': 'status-pending',
                'confirmed': 'status-confirmed',
                'processing': 'status-processing',
                'shipped': 'status-shipped',
                'delivered': 'status-delivered',
                'cancelled': 'status-cancelled'
            };
            return statusMap[status] || 'status-pending';
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pending',
                'confirmed': 'Confirmed',
                'processing': 'Processing',
                'shipped': 'Shipped',
                'delivered': 'Delivered',
                'cancelled': 'Cancelled'
            };
            return statusMap[status] || status.charAt(0).toUpperCase() + status.slice(1);
        }

        // Load analytics data
        async function loadAnalytics() {
            const token = localStorage.getItem('token');
            const period = document.getElementById('analyticsPeriod').value;

            try {
                // Load revenue analytics
                const revenueResponse = await fetch(`/api/admin/revenue?period=${period}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (revenueResponse.ok) {
                    const revenueData = await revenueResponse.json();
                    displayRevenueAnalytics(revenueData);
                }

                // Load comprehensive analytics
                const analyticsResponse = await fetch('/api/admin/analytics', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (analyticsResponse.ok) {
                    const analyticsData = await analyticsResponse.json();
                    displayAnalyticsCharts(analyticsData);
                    displayTopProducts(analyticsData.topProducts);
                }

            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Display revenue analytics
        function displayRevenueAnalytics(data) {
            document.getElementById('analyticsRevenue').textContent = formatCurrency(data.total_revenue || 0);
            document.getElementById('analyticsOrders').textContent = data.total_orders || 0;
            document.getElementById('analyticsAvgOrder').textContent = formatCurrency(data.average_order_value || 0);

            const completionRate = data.total_orders > 0
                ? Math.round((data.completed_orders / data.total_orders) * 100)
                : 0;
            document.getElementById('analyticsCompletion').textContent = `${completionRate}%`;
        }

        // Display analytics charts
        function displayAnalyticsCharts(data) {
            // Revenue trend chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            const monthlyData = data.monthlyRevenue || [];

            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: monthlyData.map(item => {
                        const date = new Date(item.month + '-01');
                        return date.toLocaleDateString('en-KE', { month: 'short', year: 'numeric' });
                    }),
                    datasets: [{
                        label: 'Revenue (KES)',
                        data: monthlyData.map(item => parseFloat(item.revenue || 0)),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'KES ' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Order status distribution chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            const statusData = data.statusDistribution || [];

            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: statusData.map(item => getStatusText(item.status)),
                    datasets: [{
                        data: statusData.map(item => parseInt(item.count)),
                        backgroundColor: [
                            '#fbbf24', // pending
                            '#2563eb', // confirmed
                            '#8b4513', // processing
                            '#059669', // shipped
                            '#4b5563', // delivered
                            '#dc2626'  // cancelled
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Payment methods chart
            const paymentCtx = document.getElementById('paymentChart').getContext('2d');
            const paymentData = data.paymentMethods || [];

            new Chart(paymentCtx, {
                type: 'pie',
                data: {
                    labels: paymentData.map(item => item.payment_method || 'Other'),
                    datasets: [{
                        data: paymentData.map(item => parseFloat(item.total_amount || 0)),
                        backgroundColor: [
                            '#2563eb',
                            '#059669',
                            '#8b4513',
                            '#dc2626'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Display top products
        function displayTopProducts(products) {
            const container = document.getElementById('topProducts');

            if (!products || products.length === 0) {
                container.innerHTML = '<p class="text-muted">No product data available</p>';
                return;
            }

            container.innerHTML = products.map((product, index) => `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="d-flex align-items-center">
                        <span class="badge bg-primary me-2">${index + 1}</span>
                        <div>
                            <strong>${product.product_name}</strong>
                            <br>
                            <small class="text-muted">${product.order_count} orders</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold">${formatCurrency(product.total_revenue)}</div>
                        <small class="text-muted">${product.total_quantity} units</small>
                    </div>
                </div>
            `).join('');
        }

        // Load dashboard data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });
    </script>
</body>
</html>